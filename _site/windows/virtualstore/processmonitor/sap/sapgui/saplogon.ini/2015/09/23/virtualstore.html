<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>VirtualStore?</title>
  <meta name="description" content="The other day I wanted to change the list of servers within my SAP GUI.">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="/css/lightbox.css">
  <link rel="canonical" href="https://alistairmcmillan.github.io/windows/virtualstore/processmonitor/sap/sapgui/saplogon.ini/2015/09/23/virtualstore.html">
  <link rel="alternate" type="application/rss+xml" title="alistair mcmillan" href="https://alistairmcmillan.github.io/feed.xml" />
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">alistair mcmillan</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">VirtualStore?</h1>
    <p class="post-meta">23 September 2015</p>
  </header>

  <article class="post-content">
    <p>The other day I wanted to change the list of servers within my SAP GUI.</p>

<p><a class="image" href="/images/SAP Logon Pad.png" data-lightbox="image-1" data-title="SAP GUI aka Logon Pad">
<img src="/images/SAP Logon Pad.png" style="width:400px;" /></a></p>

<p>The GUI gets the list from a plain text file called saplogon.ini. That file can be stored anywhere though. If you check PCs with SAP installed it’s not unusual to find more than one saplogon.ini file in various places. The quickest way to find the one that is being used is to check  Options within the SAP GUI (click on the icon in the top-left corner of the GUI window and choose “Options…” from the menu). If you select Local Configuration Files it should tell you the location of the saplogon.ini file that is actually in use.</p>

<p><a class="image" href="/images/SAP GUI Options.png" data-lightbox="image-1" data-title="SAP GUI Options">
<img src="/images/SAP GUI Options.png" style="width:400px;" /></a></p>

<p>So it’s using c:\Windows\SAPLOGON.INI. I closed the GUI, swapped that file and reopened the GUI. But it didn’t recognise that anything had changed. I tried a few different things but it failed to recognise anything changing. So where was it reading that information from? Even though the software claimed to be reading from c:\Windows\SAPLOGON.INI that didn’t seem to be the case.</p>

<p>A handy tool to see where applications are reading and writing to is <a href="https://technet.microsoft.com/en-us/sysinternals/bb896645">Process Monitor</a> from Sysinternals (now part of Microsoft). By default it shows you pretty much all activity on your machine but you can filter it to look for something specific. In this case I opened the Filter dialog (CTRL-L), created a rule to look for “Path” “contains” “SAPLOGON.INI”, clicked the Add button and then OK.</p>

<p><a class="image" href="/images/Process Monitor filter for SAPLOGON.INI.png" data-lightbox="image-1" data-title="Process Monitor filter for paths containing SAPLOGON.INI">
<img src="/images/Process Monitor filter for SAPLOGON.INI.png" style="width:400px;" /></a></p>

<p>Now with the filter running, I reopened the SAP GUI and as you can see the application was actually reading a completely different saplogon.ini stored in c:\Users\alistair\AppData\Local\VirtualStore\Windows.</p>

<p><a class="image" href="/images/Process Monitor filtered on SAPLOGON.INI.png" data-lightbox="image-1" data-title="Process Monitor filtered on SAPLOGON.INI">
<img src="/images/Process Monitor filtered on SAPLOGON.INI.png" style="width:400px;" /></a></p>

<h2 id="so-what-is-the-virtualstore-folder">So what is the VirtualStore folder?</h2>

<p>From an article on Microsoft’s TechNet Magazine called <a href="https://technet.microsoft.com/en-us/magazine/2007.06.uac.aspx">Inside Windows Vista User Account Control</a> (the feature was introduced with Vista but it’s there in later versions of Windows too):</p>

<blockquote>
  <p>While some software legitimately requires administrative rights, many programs needlessly store user data in system-global locations.</p>
</blockquote>

<blockquote>
  <p>Windows Vista enables these legacy applications to run in standard user accounts through the help of file system and registry namespace virtualization. When an application modifies a system-global location in the file system or registry and that operation fails because access is denied, Windows redirects the operation to a per-user area; when the application reads from a system-global location, Windows first checks for data in the per-user area and, if none is present, permits the read attempt from the global location.</p>
</blockquote>

<blockquote>
  <p>For the purposes of this virtualization, Windows Vista treats a process as legacy if it’s 32-bit (versus 64-bit), is not running with administrative rights, and does not have a manifest file indicating that it was written for Windows Vista.</p>
</blockquote>

<p>So Windows is recognising that the version of the SAP GUI that I’m running (version 730) was designed for a previous version of Windows where security wasn’t taken so seriously. Although the application thinks it is talking to the ini file in the c:\Windows folder, Windows is actually redirecting those requests to a copy of the file within my own profile where I don’t need administrator rights. Quietly behind the scenes. Leaving this legacy application unaware that anything is happening.</p>

<p>So I swapped the file in that VirtualStore folder and the SAP GUI picked up the changes. Alternatively I could have deleted the copy in my VirtualStore and Windows would have allowed the application to talk to the original I’d already changed in the c:\Windows folder.</p>

  </article>

  <div id="disqus_thread"></div>
  <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'alistairmcmillan';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col  footer-col-1">
        <ul class="contact-list">
          <li>alistair mcmillan</li>
          <li><a href="mailto:alistair@mcmillan.cx">alistair@mcmillan.cx</a></li>
        </ul>
      </div>

      <div class="footer-col  footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/alistairmcmillan">
              <span class="icon  icon--github">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
                </svg>
              </span>

              <span class="username">alistairmcmillan</span>
            </a>
          </li>
          

          
          <li>
            <a href="https://twitter.com/alistair1975">
              <span class="icon  icon--twitter">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                  c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/>
                </svg>
              </span>

              <span class="username">alistair1975</span>
            </a>
          </li>
          
        </ul>
      </div>

      <div class="footer-col  footer-col-3">
        <p class="text">Mostly a place for me to note things down so I don't forget them.</p>
      </div>
    </div>

  </div>

  <script src="/js/jquery.min.js"></script>
  <script src="/js/lightbox.min.js" ></script>

</footer>


  </body>

</html>
